<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Scan History</title>

<style>
:root {
  --bg-main:#020617;
  --bg-card:#0b1220;
  --bg-panel:#0f172a;
  --border:#1e293b;
  --accent:#38bdf8;
  --success:#22c55e;
  --danger:#ef4444;
  --text-main:#e5e7eb;
  --text-muted:#94a3b8;
}

* { box-sizing:border-box; font-family:Inter,Segoe UI,sans-serif }

body {
  margin:0;
  background:var(--bg-main);
  color:var(--text-main);
}


.topbar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 36px;
  border-bottom:1px solid var(--border);
}

.topbar h1 {
  font-size:18px;
  color:var(--accent);
  margin:0;
}

.back-btn {
  background:var(--accent);
  border:none;
  color:#fff;
  padding:6px 12px;
  border-radius:10px;
  cursor:pointer;
  font-size:13px;
  margin-left:12px;
}

/* Container */
.container {
  max-width:1300px;
  margin:36px auto;
  padding:0 24px;
}

/* Panel */
.panel {
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:26px;
}

.panel h2 {
  font-size:16px;
  margin-bottom:18px;
  color:#cbd5f5;
}

/* Table */
table {
  width:100%;
  border-collapse:collapse;
}

th, td {
  padding:14px;
  font-size:13px;
  border-bottom:1px solid var(--border);
  text-align:left;
}

th {
  color:var(--text-muted);
  font-weight:600;
}

.status-success { color:var(--success) }
.status-failed { color:var(--danger) }

.download-btn {
  background:var(--accent);
  border:none;
  color:#fff;
  padding:6px 14px;
  border-radius:8px;
  cursor:pointer;
  font-size:12px;
  margin-right:6px;
}

/* Modal */
#scanModal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
}

#scanModalContent {
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:16px;
  max-width:600px;
  margin:80px auto;
  padding:24px;
}
</style>
</head>

<body>

<div class="topbar">
  <h1>Network Topology Visualization System</h1>
  <button class="back-btn" onclick="goBack()">Home</button>
</div>

<div class="container">
  <div class="panel">
    <h2>Scan History</h2>

    <table id="scanTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Scan Type</th>
          <th>Target</th>
          <th>Date & Time</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>


<div id="scanModal">
  <div id="scanModalContent">
    <h3 style="color:var(--accent);margin-top:0">Scan Result</h3>
    <div id="scanDetails" style="font-size:13px;line-height:1.8"></div>
    <div style="text-align:right;margin-top:20px">
      <button class="download-btn" onclick="closeModal()">Close</button>
    </div>
  </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>

function goBack() {
  window.location.href = "dashboard.html"; 
}


if (!localStorage.getItem("scanHistory")) {
  const demoHistory = [
    {
      mode: "Single",
      target: "192.168.1.1",
      time: "2026-01-03 09:21 UTC",
      status: "Success",
      summary: "5 hosts discovered, 1 router detected"
    },
    {
      mode: "Continuous",
      target: "192.168.1.0/24",
      time: "2026-01-02 18:10 UTC",
      status: "Success",
      summary: "24 hosts discovered, 3 routers detected"
    }
  ];
  localStorage.setItem("scanHistory", JSON.stringify(demoHistory));
}


const scanHistory = JSON.parse(localStorage.getItem("scanHistory")) || [];
const tbody = document.querySelector("#scanTable tbody");
tbody.innerHTML = ""; 
scanHistory.forEach((scan, index) => {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${index + 1}</td>
    <td>${scan.mode}</td>
    <td>${scan.target}</td>
    <td>${scan.time}</td>
    <td class="${scan.status === 'Success' ? 'status-success' : 'status-failed'}">
      ${scan.status}
    </td>
    <td>
      <button class="download-btn" onclick="viewScan(${index})">View</button>
      <button class="download-btn" onclick="downloadPDF(${index})">Download</button>
    </td>
  `;
  tbody.appendChild(row);
});


function viewScan(index) {
  const scan = scanHistory[index];
  document.getElementById("scanDetails").innerHTML = `
    <strong>Scan Type:</strong> ${scan.mode}<br>
    <strong>Target:</strong> ${scan.target}<br>
    <strong>Date & Time:</strong> ${scan.time}<br>
    <strong>Status:</strong> ${scan.status}<br>
    <strong>Summary:</strong> ${scan.summary || "No additional details available"}
  `;
  document.getElementById("scanModal").style.display = "block";
}

function closeModal() {
  document.getElementById("scanModal").style.display = "none";
}


function downloadPDF(index) {
  const { jsPDF } = window.jspdf;
  const scan = scanHistory[index];

  const pdf = new jsPDF();
  pdf.setFontSize(16);
  pdf.text("Network Scan Report", 20, 20);

  pdf.setFontSize(11);
  pdf.text(`Scan Type: ${scan.mode}`, 20, 40);
  pdf.text(`Target: ${scan.target}`, 20, 50);
  pdf.text(`Date & Time: ${scan.time}`, 20, 60);
  pdf.text(`Status: ${scan.status}`, 20, 70);
  pdf.text(`Summary: ${scan.summary || "N/A"}`, 20, 80);

  pdf.save(`scan-report-${index + 1}.pdf`);
}
</script>

</body>
</html>
